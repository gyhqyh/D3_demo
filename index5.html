<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <style>
        .d1 {
            width: 300px;
            height: 300px;
            padding: 20px;
            border: 1px solid grey;
        }
    </style>
</head>
<body>
<button id='update'>update</button>
<button id='add'>add</button>
<button id='del'>del</button>
</body>
<script>
    window.onload = function () {
        let p = {t: 20, l: 30, r: 20, b: 20};
        let width = 400;
        let height = 400;
        let data = [50, 60, 70, 55, 46, 33, 80];
        let svg = d3.select('body').append('svg').attr('class', 'svg1').attr('width', p.l + p.r + width).attr('height', p.t + p.b + height)
        let yScale = d3.scaleLinear().domain([0, 1.2 * d3.max(data)]).range([0, height]);
        let xScale = d3.scaleBand().domain(d3.range(data.length)).range([0, width]).paddingInner(0.2).paddingOuter(0.2)
        console.log(xScale.bandwidth(), d3)
        svg.selectAll('.item')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'item')
                .attr('width', xScale.bandwidth())
                .attr('height', function (d, i) {return yScale(d)})
                .attr('x', function (d, i) {return p.l + xScale(i)})
                .attr('y', function (d, i) {return p.t + height - yScale(d)})
                .attr('style', 'fill: #0f0')
        svg.selectAll('.textNode')
            .data(data)
            .enter()
            .append('text')
            .attr('class', 'textNode')
            .attr('x', function (d, i) {return p.l + xScale(i)})
            .attr('y', function (d, i) {return p.t + height - yScale(d)})
            .attr('text-anchor', 'middle')
            .attr('dy', '1em')
            .attr('dx', xScale.bandwidth()/2)
            .text(function (d, i) {return d})
        console.log(d3.selectAll('item'), 8888);
       let xAxis = d3.axisBottom(xScale)
       let xgAxis = svg.append('g').attr('transform', 'translate(' + p.l + ',' + (p.t + height) + ')').attr('class', 'gx').call(xAxis)
       yScale.range([height, 0])
       let yAxis = d3.axisLeft(yScale)
       let ygAxis = svg.append('g').attr('transform', 'translate(' + p.l + ',' + p.t + ')').attr('class', 'gy').call(yAxis);
    //    console.log(gzj, '99999');
       function draw() {
                yScale.domain([0, 1.2 * d3.max(data)]).range([0, height]);
                xScale.domain(d3.range(data.length)).range([0, width]);
                let update = svg.selectAll('.item').data(data)
                update
                    .attr('width', xScale.bandwidth)
                    .transition()
                    .attr('height', function (d, i) {return yScale(d)})
                    .attr('x', function (d, i) {return p.l + xScale(i)})
                    .attr('y', function (d, i) {return p.t + height - yScale(d)})
                let enter = update.enter()
                enter
                    .append('rect')
                    .attr('class', 'item')
                    .attr('width', xScale.bandwidth)
                    .attr('x', function (d, i) {return p.l + xScale(i)})
                    .attr('y', function (d, i) {return p.t + height - yScale(d)})
                    .attr('style', 'fill: #0f0')
                    .transition()
                    .attr('height', function (d, i) {return yScale(d)})
                let exit = update.exit()
                exit.transition().attr('width', 0).remove()

                let updateT = svg.selectAll('.textNode').data(data)
                updateT
                    // .transition()
                    .attr('x', function (d, i) {return p.l + xScale(i)})
                    .transition()
                    .attr('y', function (d, i) {return p.t + height - yScale(d)})
                    .attr('dx', xScale.bandwidth()/2)
                    .text(function (d, i) {return d})
                let enterT = updateT.enter()
                enterT
                    .append('text')
                    .attr('class', 'textNode')
                    .attr('x', function (d, i) {return p.l + xScale(i)})
                    .transition()
                    .attr('y', function (d, i) {return p.t + height - yScale(d)})
                    .attr('text-anchor', 'middle')
                    .attr('dy', '1em')
                    .attr('dx', xScale.bandwidth()/2)
                    .text(function (d, i) {return d})
                let exitT = updateT.exit()
                exitT.remove();

                yScale.range([height, 0])
                ygAxis.call(yAxis);
                xgAxis.call(xAxis); 
       }
       document.getElementById('update').onclick = function () {
           d3.shuffle(data);
            draw();
       }
       document.getElementById('add').onclick = function () {
           data.push(200);
           draw();
       }
       document.getElementById('del').onclick = function () {
            data.pop()
           draw();
       }
     }
</script>
<script src="https://cdn.bootcss.com/d3/5.15.0/d3.js"></script>
</html>